<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="settings_title">Einstellungen - Room8</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .settings-container { max-width: 800px; margin: 0 auto; padding: 1rem; padding-bottom: 2rem; }
        .settings-menu { margin-top: 1rem; }
        .settings-section { margin-bottom: 2rem; }
        .settings-section h2 { font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; color: #6b7280; margin: 0 0 0.75rem 0; padding: 0 0.5rem; }
        .settings-item { background: white; border-radius: 12px; margin-bottom: 0.5rem; border: 1px solid #e5e7eb; overflow: hidden; }
        .settings-link { display: flex; align-items: center; padding: 1rem 1.25rem; text-decoration: none; color: #111827; transition: background 0.2s; }
        .settings-link:hover { background: #f9fafb; }
        .settings-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; margin-right: 1rem; flex-shrink: 0; }
        .icon-profile { background: #dbeafe; }
        .icon-notifications { background: #fef3c7; }
        .icon-search { background: #d1fae5; }
        .icon-favorites { background: #fee2e2; }
        .icon-security { background: #ede9fe; }
        .icon-help { background: #e0e7ff; }
        .icon-language { background: #fce7f3; }
        .settings-info { flex: 1; }
        .settings-info h3 { margin: 0 0 0.25rem 0; font-size: 1rem; font-weight: 600; }
        .settings-info p { margin: 0; font-size: 0.875rem; color: #6b7280; }
        .settings-arrow { color: #9ca3af; font-size: 1.25rem; }
        .logout-section { margin-top: 2rem; text-align: center; padding-bottom: 2rem; }
        .logout-btn { background: #fee2e2; color: #dc2626; border: none; padding: 0.75rem 2rem; border-radius: 8px; font-size: 0.95rem; font-weight: 600; cursor: pointer; }
        .logout-btn:hover { background: #fecaca; }
        .user-info { background: white; border-radius: 12px; padding: 1.5rem; text-align: center; margin-bottom: 2rem; border: 1px solid #e5e7eb; }
        .user-avatar { width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 1rem; background: linear-gradient(135deg, #10b981, #059669); color: white; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 600; }
        .user-name { font-size: 1.25rem; font-weight: 600; margin: 0 0 0.25rem 0; }
        .user-email { color: #6b7280; font-size: 0.9rem; }
        .language-selector { display: flex; gap: 0.5rem; margin-left: auto; }
        .lang-btn { padding: 0.5rem 1rem; border: 2px solid #e5e7eb; border-radius: 8px; background: white; cursor: pointer; font-size: 0.9rem; font-weight: 500; }
        .lang-btn:hover { border-color: #10b981; }
        .lang-btn.active { background: #10b981; color: white; border-color: #10b981; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <a href="profile.html" class="back-arrow">&#8592;</a>
            <h1 data-i18n="settings_title">Einstellungen</h1>
        </header>

        <div class="settings-container">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">?</div>
                <h2 class="user-name" id="userName" data-i18n="loading">Laden...</h2>
                <p class="user-email" id="userEmail" data-i18n="loading">Laden...</p>
            </div>

            <div class="settings-menu">
                <div class="settings-section">
                    <h2 data-i18n="settings_language">Sprache</h2>
                    <div class="settings-item">
                        <div class="settings-link" style="cursor: default;">
                            <div class="settings-icon icon-language">&#127760;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_choose_language">Sprache w√§hlen</h3>
                                <p data-i18n="settings_choose_language_desc">W√§hle deine bevorzugte Sprache</p>
                            </div>
                            <div class="language-selector">
                                <button class="lang-btn" id="langDE" onclick="switchLanguage('de')">üá©üá™ DE</button>
                                <button class="lang-btn" id="langEN" onclick="switchLanguage('en')">üá¨üáß EN</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h2 data-i18n="settings_account">Konto &amp; Profil</h2>
                    <div class="settings-item">
                        <a href="edit-profile.html" class="settings-link">
                            <div class="settings-icon icon-profile">&#128100;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_edit_profile">Profil bearbeiten</h3>
                                <p data-i18n="settings_edit_profile_desc">Name, Foto, Bio √§ndern</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                    <div class="settings-item">
                        <a href="notification-settings.html" class="settings-link">
                            <div class="settings-icon icon-notifications">&#128276;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_notifications">Benachrichtigungen</h3>
                                <p data-i18n="settings_notifications_desc">Push &amp; E-Mail Einstellungen</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                    <div class="settings-item">
                        <a href="saved-searches.html" class="settings-link">
                            <div class="settings-icon icon-search">&#128269;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_saved_searches">Gespeicherte Suchen</h3>
                                <p data-i18n="settings_saved_searches_desc">Benachrichtigungen f√ºr passende Inserate</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                    <div class="settings-item">
                        <a href="notifications.html" class="settings-link">
                            <div class="settings-icon icon-notifications">&#128236;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_all_notifications">Alle Benachrichtigungen</h3>
                                <p data-i18n="settings_all_notifications_desc">√úbersicht aller Benachrichtigungen</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                </div>

                <div class="settings-section">
                    <h2 data-i18n="settings_my_content">Meine Inhalte</h2>
                    <div class="settings-item">
                        <a href="favorites.html" class="settings-link">
                            <div class="settings-icon icon-favorites">&#10084;&#65039;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_favorites">Meine Favoriten</h3>
                                <p data-i18n="settings_favorites_desc">Gespeicherte Wohnungen, Gegenst√§nde &amp; Jobs</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                    <div class="settings-item">
                        <a href="profile.html" class="settings-link">
                            <div class="settings-icon icon-profile">&#128203;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_my_listings">Meine Inserate</h3>
                                <p data-i18n="settings_my_listings_desc">Verwalte deine Anzeigen</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                </div>

                <div class="settings-section">
                    <h2 data-i18n="settings_privacy">Datenschutz &amp; Sicherheit</h2>
                    <div class="settings-item">
                        <a href="faq.html" class="settings-link">
                            <div class="settings-icon" style="background: #dbeafe;">&#10067;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_help">Hilfe &amp; FAQ</h3>
                                <p data-i18n="settings_help_desc">H√§ufige Fragen &amp; Kontakt</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                    <div class="settings-item">
                        <a href="datenschutz.html" class="settings-link">
                            <div class="settings-icon icon-security">&#128274;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_privacy_policy">Datenschutz</h3>
                                <p data-i18n="settings_privacy_policy_desc">Datenschutzerkl√§rung</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                    <div class="settings-item">
                        <a href="nutzungsbedingungen.html" class="settings-link">
                            <div class="settings-icon" style="background: #d1fae5;">&#128220;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_terms">Nutzungsbedingungen</h3>
                                <p data-i18n="settings_terms_desc">AGB &amp; Regeln der Plattform</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                    <div class="settings-item">
                        <a href="nutzungsbedingungen.html#mustervertraege" class="settings-link">
                            <div class="settings-icon" style="background: #fef3c7;">&#128203;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_templates">Mustervertr√§ge &amp; Vorlagen</h3>
                                <p data-i18n="settings_templates_desc">Untermietvertrag, Kaufvertrag, Checklisten</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                    <div class="settings-item">
                        <a href="impressum.html" class="settings-link">
                            <div class="settings-icon icon-help">&#8505;&#65039;</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_imprint">Impressum</h3>
                                <p data-i18n="settings_imprint_desc">Rechtliche Informationen</p>
                            </div>
                            <span class="settings-arrow">&#8250;</span>
                        </a>
                    </div>
                </div>

                <!-- Admin Section (nur f√ºr Admins sichtbar) -->
                <div class="settings-section" id="adminSection" style="display: none;">
                    <h2 data-i18n="settings_admin">Administration</h2>
                    <div class="settings-item">
                        <a href="admin.html" class="settings-link" style="background: linear-gradient(135deg, #1f2937 0%, #374151 100%); color: white;">
                            <div class="settings-icon" style="background: #fbbf24;">üõ†Ô∏è</div>
                            <div class="settings-info">
                                <h3 data-i18n="settings_admin_panel" style="color: white;">Admin Panel</h3>
                                <p data-i18n="settings_admin_panel_desc" style="color: rgba(255,255,255,0.8);">Benutzer, Verifizierungen, Meldungen verwalten</p>
                            </div>
                            <span class="settings-arrow" style="color: white;">&#8250;</span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="logout-section">
                <button class="logout-btn" id="logoutBtn" data-i18n="logout">Ausloggen</button>
            </div>
        </div>
    </div>

    <script src="translations.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script>
        var supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function switchLanguage(newLang) {
            localStorage.setItem('room8_language', newLang);
            localStorage.setItem('language', newLang);
            window.location.reload();
        }

        function initLanguageButtons() {
            var lang = localStorage.getItem('room8_language') || localStorage.getItem('language') || 'de';
            document.getElementById('langDE').classList.toggle('active', lang === 'de');
            document.getElementById('langEN').classList.toggle('active', lang === 'en');
        }

        function loadUserData() {
            supabase.auth.getUser().then(function(res) {
                if (!res.data.user) { window.location.href = 'login.html'; return; }
                var user = res.data.user;
                supabase.from('profiles').select('username, full_name, avatar_url, is_admin, role').eq('id', user.id).single().then(function(p) {
                    if (p.data) {
                        var name = p.data.full_name || p.data.username || 'User';
                        document.getElementById('userName').textContent = name;
                        document.getElementById('userEmail').textContent = user.email;
                        document.getElementById('userAvatar').textContent = name.charAt(0).toUpperCase();
                        if (p.data.avatar_url) {
                            document.getElementById('userAvatar').style.backgroundImage = 'url(' + p.data.avatar_url + ')';
                            document.getElementById('userAvatar').style.backgroundSize = 'cover';
                            document.getElementById('userAvatar').textContent = '';
                        }
                        // Admin Section anzeigen wenn User Admin ist
                        if (p.data.is_admin === true || p.data.role === 'admin') {
                            document.getElementById('adminSection').style.display = 'block';
                        }
                    }
                });
            });
        }

        document.getElementById('logoutBtn').addEventListener('click', function() {
            var lang = localStorage.getItem('room8_language') || localStorage.getItem('language') || 'de';
            var confirmMsg = lang === 'en' ? 'Do you really want to log out?' : 'M√∂chtest du dich wirklich ausloggen?';
            if (confirm(confirmMsg)) {
                supabase.auth.signOut().then(function() { window.location.href = 'login.html'; });
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            initLanguageButtons();
            loadUserData();
        });
    </script>
    <script src="navigation.js"></script>
</body>
</html>
